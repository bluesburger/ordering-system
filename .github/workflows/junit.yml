
name: Test and Coverage with JaCoCo (Maven)

on:
  workflow_dispatch:

jobs:
  test-and-check-coverage:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'

      - name: Build and run tests with JaCoCo
        run: mvn clean verify

#      - name: Upload JaCoCo coverage report
#        uses: actions/upload-artifact@v2
#        with:
#          name: jacoco-report
#          path: target/site/jacoco
#
#      - name: Publish coverage to Codecov
#        uses: codecov/codecov-action@v2
#        with:
#          token: ${{ secrets.CODECOV_TOKEN }}
#
#      - name: Check coverage thresholds
#        run: |
#          COVERAGE=$(sed -n 's/.*<line.*total="\(.*\)".*/\1/p' target/site/jacoco/jacoco.xml)
#          if (( $(echo "$COVERAGE < 80" | bc -l) )); then
#            echo "Error: Coverage is below threshold (80%)"
#            exit 1
#          fi


